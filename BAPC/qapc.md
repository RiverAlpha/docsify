## 1. 官方介绍
> Function to compute quantiles for age-specific (and age-standardized) rates or projections.

**Description**

Function to compute quantiles for age-specific (and age-standardized) rates or projections.

**Usage**

  qapc(APCList, percentiles=c(0.025, seq(0.05, 0.95, by=0.05), 0.975))

**Arguments**

- APCList	
    APCList object generated by the BAPC function.

- percentiles	
    Probabilities related to percentiles or prediction intervals which should be computed. These values must be between 0 and 1.

**Value**

An APCList object where the desired quantiles are added to agespec.rate(APCList), agespec.proj(APCList) and if available agestd.rate(APCList), agestd.proj(APCList). Note only quantiles that are not yet available will be added.

Example
```R
if(requireNamespace("INLA", quietly = TRUE)) {
    require(INLA)
    data(FemLCSweden)
    data(FemPYSweden)
    data(whostandard)

    lc_sweden <- APCList(FemLCSweden, FemPYSweden, gf=5)

    result <- BAPC(lc_sweden, predict=list(npredict=10, retro=TRUE),
        verbose=FALSE, stdweight=whostandard[6:17,2])

    result <- qapc(result)
    head(agespec.proj(result)[[1]])
}
```


## 2. 源码

```R
function (APCList, percentiles = c(0.025, seq(0.05, 0.95, by = 0.05), 
  0.975)) 
{
  if (class(APCList) != "APCList") {
    stop("The first function argument must be of class \"APCList\"")
  }
  if (!is.vector(percentiles) || any(!is.numeric(percentiles) | 
    percentiles > 1 | percentiles < 0)) {
    stop("The second function argument must be a numeric vector with values between 0 and 1.")
  }
  ap <- agespec.proj(APCList)
  ar <- agespec.rate(APCList)
  newcolnames <- paste(percentiles, "Q", sep = "")
  oldcolnames <- colnames(ap[[1]])
  lold <- length(oldcolnames)
  which.new <- which(!(newcolnames %in% oldcolnames))
  if (length(which.new) == 0) {
    stop("The desired percentiles are already available.")
  }
  if (any(newcolnames %in% oldcolnames)) {
    print("Note: Some or all of the percentiles are already available.")
  }
  percentiles <- percentiles[which.new]
  I <- nage(APCList)
  J <- nperiod(APCList)
  res <- inlares(APCList)
  inlaq <- t(sapply(1:(I * J), function(i) {
    INLA::inla.qmarginal(percentiles, res$marginals.linear.predictor[[i]])
  }))
  pre <- exp(inlaq)
  for (j in 1:nage(APCList)) {
    ap[[j]] = cbind(ap[[j]], t(sapply(1:J, function(i) {
      qnorm(percentiles, mean = ap[[j]][i, 1], sd = ap[[j]][i, 
        2])
    })))
    ap[[j]][ap[[j]] < 0] = 0
    if (lold == 2) {
      colnames(ap[[j]]) <- c("mean", "sd", paste(percentiles, 
        "Q", sep = ""))
    }
    else {
      colnames(ap[[j]]) <- c("mean", "sd", oldcolnames[-c(1, 
        2)], paste(percentiles, "Q", sep = ""))
    }
  }
  agespec.proj(APCList) <- ap
  plab = periodlabels(APCList)
  agespec.rate(APCList) <- lapply(1:I, function(m) {
    tmp = cbind(ar[[m]], pre[((m - 1) * J + 1):(m * J), 
      ])
    rownames(tmp) <- plab
    if (lold == 2) {
      colnames(tmp) <- c("mean", "sd", paste(percentiles, 
        "Q", sep = ""))
    }
    else {
      colnames(tmp) <- c("mean", "sd", oldcolnames[-c(1, 
        2)], paste(percentiles, "Q", sep = ""))
    }
    return(tmp)
  })
  if (!any(is.na(agestd.proj(APCList)))) {
    astdp <- agestd.proj(APCList)
    astdr <- agestd.rate(APCList)
    my.quant <- t(sapply(1:J, function(j) {
      qnorm(percentiles, mean = astdr[j, 1], sd = astdr[j, 
        2])
    }))
    tmpr = cbind(astdr, my.quant)
    rownames(tmpr) = plab
    my.quantp <- t(sapply(1:J, function(j) {
      qnorm(percentiles, mean = astdp[j, 1], sd = astdp[j, 
        2])
    }))
    tmpp = cbind(astdp, my.quantp)
    rownames(tmpp) = plab
    if (lold == 2) {
      colnames(tmpr) = c("mean", "sd", paste(percentiles, 
        "Q", sep = ""))
      colnames(tmpp) = c("mean", "sd", paste(percentiles, 
        "Q", sep = ""))
    }
    else {
      colnames(tmpr) = c("mean", "sd", oldcolnames[-c(1, 
        2)], paste(percentiles, "Q", sep = ""))
      colnames(tmpp) = c("mean", "sd", oldcolnames[-c(1, 
        2)], paste(percentiles, "Q", sep = ""))
    }
    agestd.rate(APCList) <- tmpr
    agestd.proj(APCList) <- tmpp
  }
  return(APCList)
}

```

### 2.1 plotBAPC

不论plotBAPC方法的type参数为什么 都会优先用qapc方法处理我们BAPC返回的数据

> 1. type参数为'ageStdRate'时

qapc接受两个参数 一个是BAPC返回的统计数据，一个是(分位数)间隔数据
percentiles = c(0.025, seq(0.05, 0.95, by = 0.05), 0.975)
> percentiles = 0.025 0.050 0.100 0.150 0.200 0.250 0.300 0.350 0.400 0.450 0.500 0.550 0.600 0.650 0.700 0.750 0.800 0.850 0.900 0.950 0.975

- agespec.rate

    A list of length I, one for each age group. Each list element contains a matrix of dimension J * 4, where J denotes the number of periods. The columns present the 2.5% CI, the mean of the rate, the 97.5% CI and the standard deviation of the rate.

- agespec.proj

    A list of length I, one for each age group. Each list element contains a matrix of dimension J * 4, where J denotes the number of periods. The columns present the 2.5% CI, the mean of the predictive distribution, the 97.5% CI and the standard deviation of the predictive distribution.